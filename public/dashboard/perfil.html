<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <title>Perfil - Info-Strike</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: sans-serif;
      max-width: 900px;
      margin: auto;
      padding: 20px;
    }

    canvas {
      max-width: 100%;
    }
  </style>
</head>

<body>
  <h2>Seu Perfil de Arte Marcial</h2>
  <canvas id="graficoRadar"></canvas>

  <script>
    const idusuario = sessionStorage.ID_USUARIO;

    function carregarGraficoRadar() {
      fetch(`/respostas/obterRespostas/${idusuario}`, { cache: 'no-store' })
        .then(response => {
          if (!response.ok) throw new Error("Erro ao buscar respostas.");
          return response.json();
        })
        .then(respostas => {
          if (respostas.length === 0) {
            alert("Nenhuma resposta encontrada.");
            return;
          }
          const dadosUsuario = respostas[0].usuario;
          const dadosArteMarcial = respostas[0].arteMarcial;
          const nomeArteMarcial = dadosArteMarcial.nome || "Arte Marcial";


          const criterios = [
            "Contato", "Distância de combate", "Objetivo na luta",
            "Praticidade/Realismo", "Forma de Vitória",
            "Tipo de golpe especializado", "Tipo de treinamento"
          ];

          const dados = {

            labels: criterios,
            datasets: [{
              label: "Você",
              data: [
                dadosUsuario.r1, dadosUsuario.r2, dadosUsuario.r3,
                dadosUsuario.r4, dadosUsuario.r5, dadosUsuario.r6, dadosUsuario.r7
              ],
              backgroundColor: "rgba(0, 0, 175, 0.2)",
              borderColor: "rgba(0, 0, 175, 1)",
              pointBackgroundColor: "rgba(0, 0, 175, 1)"
            },
            {
              label: dadosArteMarcial.nome,
              data: [
                dadosArteMarcial.r1, dadosArteMarcial.r2, dadosArteMarcial.r3,
              dadosArteMarcial.r4, dadosArteMarcial.r5, dadosArteMarcial.r6, dadosArteMarcial.r7
              ],
              backgroundColor: "rgba(175, 0, 0, 0.2)",
              borderColor: "rgba(175, 0, 0, 1)",
              pointBackgroundColor: "rgba(175, 0, 0, 1)"
            }]
          };

          const config = {
            type: 'radar',
            data: dados,
            options: {
              scales: {
                r: {
                  beginAtZero: true,
                  min: 0,
                  max: 100,
                  ticks: { stepSize: 10 },
                  pointLabels: { font: { size: 14 } }

                }
              }
            }
          };

          const ctx = document.getElementById("graficoRadar");
          new Chart(ctx, config);
        })
        .catch(error => {
          console.error("Erro ao carregar o gráfico:", error.message);
        });
    }

    carregarGraficoRadar();
  </script>
</body>

</html>